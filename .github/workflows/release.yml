name: Release
on:
  workflow_run:
    workflows: ["Check"]
    branches: [main]
    types: [completed]

permissions: {}

jobs:
  release:
    if: github.event.workflow_run.conclusion == 'success'
    permissions:
      contents: write
      id-token: write
      pull-requests: write
      packages: write
    uses: ./.github/workflows/release-reusable.yml
    with:
      ref: ${{ github.event.workflow_run.head_sha }}
      branch: ${{ github.event.workflow_run.head_branch }}
      package_json_path: packages/app/package.json
      pnpm_filter: ./packages/app
      bump_type: patch
      pnpm_version: 10.28.0
      publish_npm: true
      publish_github_packages: true
    secrets: inherit
